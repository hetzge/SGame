package de.hetzge.sgame.sync;

import de.hetzge.sgame.common.UUID;

public class SyncProperty<TYPE> {

	private final String id;
	private TYPE value;
	private TYPE oldValue;
	private SpreadType spreadType = Spread.NONE;

	public SyncProperty(TYPE value) {
		this.id = UUID.generateKey();
		this.value = value;
		SyncConfig.SYNC_POOL.registerSyncProperty(this);
	}

	public SyncProperty() {
		this(null);
	}

	public SyncProperty<TYPE> setSpread(SpreadType spreadType) {
		this.spreadType = spreadType;
		return this;
	}

	public TYPE getValue() {
		return this.value;
	}

	public void setValue(TYPE value) {
		this.value = value;
		if (value != this.oldValue) {
			this.oldValue = value;
			this.toMessageInSyncPool();
		}
	}

	private void toMessageInSyncPool() {
		SyncMessage syncMessage = new SyncMessage();
		syncMessage.id = this.id;
		syncMessage.value = this.value;
		SyncConfig.SYNC_POOL.addMessage(this.spreadType, syncMessage);
	}

	public long getId() {
		return this.id;
	}

}
